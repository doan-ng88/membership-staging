<!-- Refactor by cusor-->
 <!-- Generated by Cursor -->
<!-- <script setup lang="ts">
import { RouterView } from 'vue-router'
</script> -->

<template>
  <div id="app">
    <!-- Fix bug cursor -->
    <!-- <nav v-if="authStore.isAuthenticated">
      <router-link to="/">Trang chủ</router-link>
      <a href="#" @click.prevent="handleLogout" class="logout-link">
        {{ authStore.loading ? 'Đang đăng xuất...' : 'Đăng xuất' }}
      </a>
    </nav> -->

    <router-view></router-view>
  </div>
</template>
<script lang="ts">
import { defineComponent, onMounted } from 'vue';
import { useAuthStore } from '@/stores/auth';
import DropdownUser from '@/components/Header/DropdownUser.vue';
import { useRouter } from 'vue-router';

export default defineComponent({
  name: 'App',
  components: {
    DropdownUser
  },
  setup() {
    const router = useRouter();
    const authStore = useAuthStore();

    onMounted(async () => {
      try {
        // Kiểm tra và refresh token khi reload trang
        if (localStorage.getItem('token')) {
          await authStore.checkAuth();
        }
      } catch (error) {
        console.error('Auth check failed:', error);
        router.push('/login');
      }
    });

    const handleLogout = async () => {
      try {
        await authStore.logout();
      } catch (error) {
        console.error('Logout error:', error);
        // Có thể thêm thông báo lỗi cho người dùng ở đây
      }
    };

    return {
      authStore,
      handleLogout
    };
  }
});
</script>
